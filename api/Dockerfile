FROM openjdk:21-jdk

ARG APP_VERSION
ENV APP_VERSION=${APP_VERSION}

ARG JAVA_MEM_XMS
ENV JAVA_MEM_XMS=${JAVA_MEM_XMS:-512m}

ARG JAVA_MEM_XMX
ENV JAVA_MEM_XMX=${JAVA_MEM_XMX:-512m}

ARG JAVA_MEM_META
ENV JAVA_MEM_META=${JAVA_MEM_META:-256m}

ARG JAVA_EXTRA_OPTS
ENV JAVA_EXTRA_OPTS=${JAVA_EXTRA_OPTS:-}

ARG JAVA_PORT
ENV JAVA_PORT=${JAVA_PORT:-8080}

ARG SURIKATA_FX_DATABASE_HOST
ENV SURIKATA_FX_DATABASE_HOST=${SURIKATA_FX_DATABASE_HOST:-"localhost"}

ARG SURIKATA_FX_DATABASE_PORT
ENV SURIKATA_FX_DATABASE_PORT=${SURIKATA_FX_DATABASE_PORT:-5432}

ARG SURIKATA_FX_DATABASE_DB
ENV SURIKATA_FX_DATABASE_DB=${SURIKATA_FX_DATABASE_DB:-"surikata"}

ARG SURIKATA_FX_DATABASE_USERNAME
ENV SURIKATA_FX_DATABASE_USERNAME=${SURIKATA_FX_DATABASE_USERNAME:-"surikata"}

ARG SURIKATA_FX_DATABASE_PWD
ENV SURIKATA_FX_DATABASE_PWD=${SURIKATA_FX_DATABASE_PWD:-"surikata"}

ARG BLOCKCHAIN_DATABASE_HOST
ENV BLOCKCHAIN_DATABASE_HOST=${BLOCKCHAIN_DATABASE_HOST:-"localhost"}

ARG BLOCKCHAIN_DATABASE_PORT
ENV BLOCKCHAIN_DATABASE_PORT=${BLOCKCHAIN_DATABASE_PORT:-5432}

ARG BLOCKCHAIN_DATABASE_DB
ENV BLOCKCHAIN_DATABASE_DB=${BLOCKCHAIN_DATABASE_DB:-"blockchain"}

ARG BLOCKCHAIN_DATABASE_USERNAME
ENV BLOCKCHAIN_DATABASE_USERNAME=${BLOCKCHAIN_DATABASE_USERNAME:-"blockchain"}

ARG BLOCKCHAIN_DATABASE_PWD
ENV BLOCKCHAIN_DATABASE_PWD=${BLOCKCHAIN_DATABASE_PWD:-"blockchain"}

ARG EVENTEUM_DATABASE_HOST
ENV EVENTEUM_DATABASE_HOST=${EVENTEUM_DATABASE_HOST:-"localhost"}

ARG EVENTEUM_DATABASE_PORT
ENV EVENTEUM_DATABASE_PORT=${EVENTEUM_DATABASE_PORT:-5432}

ARG EVENTEUM_DATABASE_DB
ENV EVENTEUM_DATABASE_DB=${EVENTEUM_DATABASE_DB:-"eventeum"}

ARG EVENTEUM_DATABASE_USERNAME
ENV EVENTEUM_DATABASE_USERNAME=${EVENTEUM_DATABASE_USERNAME:-"eventeum"}

ARG EVENTEUM_DATABASE_PWD
ENV EVENTEUM_DATABASE_PWD=${EVENTEUM_DATABASE_PWD:-"eventeum"}

ARG DTCC_DATABASE_HOST
ENV DTCC_DATABASE_HOST=${DTCC_DATABASE_HOST:-"localhost"}

ARG DTCC_DATABASE_PORT
ENV DTCC_DATABASE_PORT=${DTCC_DATABASE_PORT:-5432}

ARG DTCC_DATABASE_DB
ENV DTCC_DATABASE_DB=${DTCC_DATABASE_DB:-"dtcc"}

ARG DTCC_DATABASE_USERNAME
ENV DTCC_DATABASE_USERNAME=${DTCC_DATABASE_USERNAME:-"dtcc"}

ARG DTCC_DATABASE_PWD
ENV DTCC_DATABASE_PWD=${DTCC_DATABASE_PWD:-"dtcc"}

COPY build/libs/api-${APP_VERSION}.jar /app/api.jar

ARG APP_COMMIT_ID
ENV APP_COMMIT_ID=${APP_COMMIT_ID}

CMD ["bash", "-c", "java -Dserver.port=${JAVA_PORT} -Xms${JAVA_MEM_XMS} -Xmx${JAVA_MEM_XMX} -Djava.security.egd=file:/dev/./urandom -XX:MaxMetaspaceSize=${JAVA_MEM_META} ${JAVA_EXTRA_OPTS} -jar /app/api.jar"]

EXPOSE ${JAVA_PORT}
